webpackJsonp([1],{"/5h8":function(t,e){},AqYs:function(t,e,i){t.exports=i.p+"static/img/logo.8e2e584.svg"},CcID:function(t,e){},"D0o+":function(t,e){},DHcz:function(t,e){},NHnr:function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=i("7+uW"),a={render:function(){var t=this.$createElement,e=this._self._c||t;return e("div",{attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var n=i("VU/8")({name:"App"},a,!1,function(t){i("CcID")},null,null).exports,o=i("/ocq"),r={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("nav",[i("div",{staticClass:"menu"},[t.navigationBack?i("router-link",{staticClass:"fas fa-arrow-left navigation-back",attrs:{to:"/",tag:"i"}}):t._e()],1),t._v(" "),i("div",{staticClass:"title"},[i("label",[t._v(t._s(t.title))])]),t._v(" "),t._m(0)])},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"icon"},[e("img",{attrs:{src:i("AqYs")}})])}]};var u=i("VU/8")({props:{title:{default:""},navigationBack:{default:!1}}},r,!1,function(t){i("DHcz")},"data-v-7a411ce2",null).exports,l={render:function(){var t=this.$createElement;return(this._self._c||t)("div",{staticClass:"menu-wrapper",class:{flex:this.flex}},[this._t("default")],2)},staticRenderFns:[]};var c={name:"Welcome",components:{ENavbar:u,EMenuWrapper:i("VU/8")({props:{flex:{default:!1}}},l,!1,function(t){i("y1UF")},"data-v-157fa0fb",null).exports},data:function(){return{labels:{menu_wrapper:{routes:"Rotas",take_me_home:"Leva-me a casa",operators:"Operadores"}}}},methods:{goRoute:function(t){"take-me-home"!==t?this.$router.push(t):alert("Ação indisponível")}}},p={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"welcome"}},[i("ENavbar",{attrs:{title:"Olá!"}}),t._v(" "),i("EMenuWrapper",{attrs:{flex:"true"}},[i("div",{staticClass:"button",on:{click:function(e){t.goRoute("routes")}}},[i("i",{staticClass:"fa fa-code-branch"}),t._v(" "),i("div",{staticClass:"text-wrapper"},[i("label",[t._v(t._s(t.labels.menu_wrapper.routes))])])]),t._v(" "),i("div",{staticClass:"button",on:{click:function(e){t.goRoute("take-me-home")}}},[i("i",{staticClass:"fa fa-home"}),t._v(" "),i("div",{staticClass:"text-wrapper"},[i("label",[t._v(t._s(t.labels.menu_wrapper.take_me_home))])])]),t._v(" "),i("div",{staticClass:"button",on:{click:function(e){t.goRoute("operators")}}},[i("i",{staticClass:"fa fa-building"}),t._v(" "),i("div",{staticClass:"text-wrapper"},[i("label",[t._v(t._s(t.labels.menu_wrapper.operators))])])])]),t._v(" "),i("EMenuWrapper",[i("h6",[t._v("Publicidade")]),t._v(" "),i("img",{attrs:{src:"http://via.placeholder.com/800x500"}})]),t._v(" "),i("EMenuWrapper",[i("h6",[t._v("Mapa de paragens")]),t._v(" "),i("img",{attrs:{src:"http://via.placeholder.com/800x500"}})])],1)},staticRenderFns:[]};var v=i("VU/8")(c,p,!1,function(t){i("D0o+")},"data-v-28042170",null).exports,_=i("Dd8w"),d=i.n(_),m=i("NYxO"),h={name:"Routes",components:{ENavbar:u},data:function(){return{tug:"o-ez65d-tug",querying:!1,currentInput:"origin",filteredStops:[],origin:void 0,destination:void 0,originValue:"",destinationValue:"",toggleTime:"departure",searchHours:(new Date).getHours(),searchMinutes:5*Math.ceil((new Date).getMinutes()/5)}},created:function(){this.$store.dispatch("getStops",this.tug)},computed:d()({},Object(m.b)({stops:function(t){return t.routes.stops},timetable:function(t){return t.routes.timetable},queryingTimetable:function(t){return t.routes.queryingTimetable}}),{originInput:{get:function(){return this.originValue},set:function(t){this.searchStop(t,"origin")}},destinationInput:{get:function(){return this.destinationValue},set:function(t){this.searchStop(t,"destination")}},stopResults:function(){var t=this;return this.filteredStops.filter(function(e){return t.origin&&"destination"===t.currentInput?t.origin.onestop_id!==e.onestop_id:!t.destination||"origin"!==t.currentInput||t.destination.onestop_id!==e.onestop_id})},showingTimeTable:function(){return!(!(this.origin&&this.destination&&!this.querying&&void 0!==this.timetable&&this.timetable.length>0)||this.queryingTimetable)},timetableEmpty:function(){return!(!this.origin||!this.destination||this.querying||void 0===this.timetable||0!==this.timetable.length||this.queryingTimetable)}}),methods:{getIconType:function(t){if(t)return"fa-"+t.vehicle_type},searchStop:function(t,e){0!==t.length?(this.filteredStops=this.stops.filter(function(e){return e.name.toLowerCase().indexOf(t.toLowerCase())>=0}),"origin"===e&&(this.originValue=t),"destination"===e&&(this.destinationValue=t)):this.filteredStops=this.stops},chooseStop:function(t){"origin"===this.currentInput&&(this.origin=t,this.originValue=t.name),"destination"===this.currentInput&&(this.destination=t,this.destinationValue=t.name),this.querying=!1,this.origin&&this.destination&&this.getTimetable()},getTimetable:function(){var t=this.searchHours-1,e=this.searchMinutes;this.$store.dispatch("getTimetable",{origin:this.origin,destination:this.destination,time:this.twoDigits(t)+":"+this.twoDigits(e)+":00",typeOfTime:this.toggleTime})},formatTime:function(t){var e=new Date("1970-01-01T"+t+"Z");return("0"+e.getHours()).substr(-2)+":"+("0"+e.getMinutes()).substr(-2)},twoDigits:function(t){return("0"+t).substr(-2)},incrementHours:function(){this.searchHours=this.searchHours<23?this.searchHours+1:0,this.getTimetable()},incrementMinutes:function(){this.searchMinutes=this.searchMinutes<55?this.searchMinutes+5:0,this.getTimetable()}},watch:{stops:function(){this.filteredStops=this.stops}}},g={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{attrs:{id:"routes"}},[i("ENavbar",{attrs:{title:"Rotas",navigationBack:"true"}}),t._v(" "),i("div",{staticClass:"search-group"},[i("div",{staticClass:"input-group"},[t._m(0),t._v(" "),i("i",{staticClass:"fa icon-type",class:[t.getIconType(t.origin)]}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.originInput,expression:"originInput"}],attrs:{type:"text"},domProps:{value:t.originInput},on:{focus:function(e){t.querying=!0,t.currentInput="origin"},input:function(e){e.target.composing||(t.originInput=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"input-group"},[t._m(1),t._v(" "),i("i",{staticClass:"fa icon-type",class:[t.getIconType(t.destination)]}),t._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:t.destinationInput,expression:"destinationInput"}],attrs:{type:"text"},domProps:{value:t.destinationInput},on:{focus:function(e){t.querying=!0,t.currentInput="destination"},input:function(e){e.target.composing||(t.destinationInput=e.target.value)}}})]),t._v(" "),i("div",{staticClass:"input-group"},[i("div",{staticClass:"info toggle"},[i("label",{staticClass:"location",class:{toggled:"departure"==t.toggleTime},on:{click:function(e){e.preventDefault(),t.toggleTime="departure",t.getTimetable()}}},[t._v("Partir")]),t._v(" "),i("label",{staticClass:"toggle-separator"},[t._v("ou")]),t._v(" "),i("label",{staticClass:"location",class:{toggled:"arrival"==t.toggleTime},on:{click:function(e){e.preventDefault(),t.toggleTime="arrival",t.getTimetable()}}},[t._v("Chegar")]),t._v(" "),i("div",{staticClass:"time"},[i("label",{staticClass:"prefix"},[t._v("às ")]),t._v(" "),i("label",{staticClass:"hours",on:{click:function(e){e.preventDefault(),t.incrementHours()}}},[t._v(t._s(t.twoDigits(t.searchHours)))]),t._v(" "),i("label",{staticClass:"time-separator"},[t._v(":")]),t._v(" "),i("label",{staticClass:"seconds",on:{click:function(e){e.preventDefault(),t.incrementMinutes()}}},[t._v(t._s(t.twoDigits(t.searchMinutes)))]),t._v(" "),i("br")])])])]),t._v(" "),t.querying?i("div",{staticClass:"title"},[t._v("Paragens")]):t._e(),t._v(" "),t.querying?i("div",{staticClass:"stops"},t._l(t.stopResults,function(e){return i("div",{key:e.onestop_id,staticClass:"result-group",on:{click:function(i){t.chooseStop(e)}}},[i("i",{staticClass:"fa icon-type",class:[t.getIconType(e)]}),t._v(" "),i("div",{staticClass:"name-group"},[i("label",{staticClass:"geo-name"},[t._v("Braga / Guimarães")]),t._v(" "),i("br"),t._v(" "),i("label",{staticClass:"stop-name"},[t._v(t._s(e.name))])])])})):t._e(),t._v(" "),t.showingTimeTable?i("div",{staticClass:"title"},[t._v("Horários")]):t._e(),t._v(" "),t.showingTimeTable?i("div",{staticClass:"timetable"},t._l(t.timetable,function(e){return i("div",{key:e.trip,staticClass:"row"},[i("div",{staticClass:"vehicle-info"},[i("label",{staticClass:"logo"},[t._v("TUG")]),t._v("\n        /\n        "),i("label",{staticClass:"route-name"},[t._v(t._s(e.route_name))])]),t._v(" "),t._m(2,!0),t._v(" "),i("div",{staticClass:"time-info"},[i("label",{staticClass:"departure"},[t._v(t._s(t.formatTime(e.departure_time)))]),t._v(" "),i("label",{staticClass:"arrival"},[t._v(t._s(t.formatTime(e.arrival_time)))])])])})):t._e(),t._v(" "),t.timetableEmpty?i("div",{staticClass:"timetableEmpty"},[i("label",[t._v("Não há transportes para esta pesquisa :(")])]):t._e()],1)},staticRenderFns:[function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"info"},[e("label",[this._v("De")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"info"},[e("label",[this._v("Para")])])},function(){var t=this.$createElement,e=this._self._c||t;return e("div",{staticClass:"time-header-info"},[e("label",[this._v("Partida")]),this._v(" "),e("label",[this._v("Chegada")])])}]};var f=i("VU/8")(h,g,!1,function(t){i("/5h8")},"data-v-0a978c8a",null).exports;s.a.use(o.a);var b=new o.a({routes:[{path:"/",name:"Welcome",component:v},{path:"/routes",name:"Routes",component:f}]}),C=i("mtWM"),y=i.n(C);s.a.use(m.a);var T=new m.a.Store({state:{routes:{stops:void 0,timetable:void 0,queryingTimetable:!1}},mutations:{setStops:function(t,e){t.routes.stops=e},queryingTimetable:function(t,e){t.routes.timetable=[],t.routes.queryingTimetable=e},setTimetable:function(t,e){t.routes.timetable=e,t.routes.queryingTimetable=!1}},actions:{getStops:function(t,e){y.a.get("https://api.tpp.pt/v1/stops",{params:{served_by:e}}).then(function(e){var i=e.data.stops.map(function(t){return{onestop_id:t.onestop_id,name:t.name,vehicle_type:t.served_by_vehicle_types[0],geometry:t.geometry}});t.commit("setStops",i)})},getTimetable:function(t,e){t.commit("queryingTimetable",!0);var i=e.origin,s=e.destination,a=e.time,n=e.typeOfTime,o=null;"departure"===n&&(o=a),y.a.get("https://api.tpp.pt/v1/route_stop_patterns",{params:{stops_visited:[i.onestop_id,s.onestop_id].join(",")}}).then(function(e){0!==e.data.route_stop_patterns.length?y.a.get("https://api.tpp.pt/v1/routes",{params:{traverses:e.data.route_stop_patterns[0].onestop_id}}).then(function(r){y.a.get("https://api.tpp.pt/v1/schedule_stop_pairs",{params:{origin_onestop_id:i.onestop_id,route_stop_pattern_onestop_id:e.data.route_stop_patterns[0].onestop_id,date:"today",time:"now"}}).then(function(i){y.a.get("https://api.tpp.pt/v1/schedule_stop_pairs",{params:{destination_onestop_id:s.onestop_id,route_stop_pattern_onestop_id:e.data.route_stop_patterns[0].onestop_id,origin_departure_between:o,date:"today",time:"now"}}).then(function(e){for(var s={},o={},u=[],l=0;l<i.data.schedule_stop_pairs.length;l++){var c=i.data.schedule_stop_pairs[l];s[c.trip]=c}for(var p=0;p<e.data.schedule_stop_pairs.length;p++){var v=e.data.schedule_stop_pairs[p];o[v.trip]=v}for(var _ in s)if(_ in o){var d=s[_].origin_departure_time,m=o[_].destination_arrival_time;if("arrival"===n){var h=function(t){return new Date("1970-01-01T"+t+"Z").getTime()};if(h(a)<h(m))continue}u.push({departure_time:d,arrival_time:m,route_name:r.data.routes[0].name})}t.commit("setTimetable",u)})})}):t.commit("queryingTimetable",!1)})}}});i("ulDn"),s.a.config.productionTip=!1,new s.a({el:"#app",router:b,store:T,components:{App:n},template:"<App/>"})},ulDn:function(t,e){},y1UF:function(t,e){}},["NHnr"]);
//# sourceMappingURL=app.2d7a9db1a3fb1a6aed3b.js.map